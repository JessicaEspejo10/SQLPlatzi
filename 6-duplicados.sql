--DUPLICADOS

--Se insertan filas ficticias para efectos de incorporar datos duplicados para el ejercicio
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1001, 'Cacilie', null, 'cmenicomb1o@earthlink.net', 3500, '2019-05-20 09:38:22', 8, 6);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1002, 'Giuseppe', null, 'gbountiff1p@t.co', 3000, '2019-03-14 00:44:22', 26, 29);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1003, 'Sydney', 'Dener', 'sdener1q@godaddy.com', 2300, '2019-09-21 04:29:02', 34, 6);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1004, 'Arabela', 'Profit', 'aprofit1r@craigslist.org', 3000, '2017-10-07 04:10:10', 13, 21);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1005, 'Bartolemo', 'Lukins', 'blukins1s@answers.com', 2000, '2018-10-27 00:11:00', 27, 28);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1006, 'Catarina', null, 'cblaase1t@blogs.com', 2000, '2019-09-22 14:48:00', 5, 9);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1007, 'Ariela', 'MacMychem', 'amacmychem1u@woothemes.com', 4500, '2018-04-25 04:15:44', 5, 18);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1008, 'Rorie', 'Simons', 'rsimons1v@issuu.com', 5000, '2018-11-06 05:48:45', 23, 13);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1009, 'Silvia', 'Triggol', 'striggol1w@prlog.org', 2500, '2017-12-01 18:57:00', 14, 20);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1010, 'Alexandr', 'Speariett', 'aspeariett1x@gov.uk', 5000, '2018-10-13 12:01:45', 23, 28);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1011, 'Rudolf', 'Fagence', 'rfagence1y@godaddy.com', 2000, '2020-08-06 13:50:12', 43, 20);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1012, 'Ferdie', null, 'fpretious1z@nature.com', 2000, '2018-10-09 11:52:51', 42, 18);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1013, 'Carmelita', 'Lievesley', 'clievesley20@oaic.gov.au', 2000, '2018-08-16 08:38:00', 42, 13);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1014, 'Ruthe', 'MacCafferty', 'rmaccafferty21@sohu.com', 3500, '2018-04-30 03:30:03', 24, 19);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1015, 'Demetrius', 'Verzey', 'dverzey22@washingtonpost.com', 4500, '2018-05-29 18:32:50', 47, 24);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1016, 'Rinaldo', 'Planque', 'rplanque23@upenn.edu', 3000, '2017-12-09 04:17:53', 50, 3);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1017, 'Kitty', 'Colvie', 'kcolvie24@globo.com', 4500, '2019-01-17 14:39:16', 9, 13);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1018, 'Bonnie', 'Karpf', 'bkarpf25@usatoday.com', 3000, '2019-08-14 03:01:38', 18, 3);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1019, 'Marquita', 'Mollison', 'mmollison26@walmart.com', 4500, '2020-06-11 01:23:52', 20, 24);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1020, 'Brocky', 'Roels', 'broels27@huffingtonpost.com', 4500, '2019-10-07 03:27:29', 19, 2);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1021, 'Maxy', 'Wimmer', 'mwimmer28@cnbc.com', 2300, '2020-08-12 10:30:59', 15, 10);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1022, 'Kynthia', null, 'kjoy29@ovh.net', 2300, '2020-07-09 11:14:24', 39, 16);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1023, 'Chloris', 'Markovic', 'cmarkovic2a@etsy.com', 4500, '2018-06-21 02:41:39', 1, 29);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1024, 'Lisle', 'Scoyles', 'lscoyles2b@mysql.com', 3500, '2019-09-27 07:52:20', 22, 14);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1025, 'Bernadine', 'Worlock', 'bworlock2c@wsj.com', 2300, '2019-03-16 19:38:21', 6, 17);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1026, 'Brad', null, 'bhazelgrove2d@bravesites.com', 2300, '2018-03-11 14:21:31', 11, 19);
insert into platzi.alumnos (id, nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id) values (1027, 'Fee', 'Delia', 'fdelia2e@ustream.tv', 4500, '2020-04-26 14:55:52', 17, 22);

--Encontrar registros duplicados por id
SELECT *
FROM platzi.alumnos AS ou
WHERE (
	SELECT COUNT(*)
	FROM platzi.alumnos AS inr
	WHERE ou.id = inr.id
)>1;

-- se agrupan registros y se enceuntran duplicados (sin incluir el id ya que es diferente en cada registro por defecto)
SELECT(
	platzi.alumnos.nombre, 
	platzi.alumnos.apellido, 
	platzi.alumnos.email, 
	platzi.alumnos.colegiatura, 
	platzi.alumnos.fecha_incorporacion, 
	platzi.alumnos.carrera_id, 
	platzi.alumnos.tutor_id
	  )::text, COUNT(*) -- el :: funciona como cast
FROM platzi.alumnos
GROUP BY platzi.alumnos.nombre, 
	platzi.alumnos.apellido, 
	platzi.alumnos.email, 
	platzi.alumnos.colegiatura, 
	platzi.alumnos.fecha_incorporacion, 
	platzi.alumnos.carrera_id, 
	platzi.alumnos.tutor_id
HAVING COUNT(*) > 1;

--agrega columna row con total de registros de fila en la base
SELECT *
FROM (
	SELECT id,
	ROW_NUMBER() OVER(
		PARTITION BY
			nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id
		ORDER BY id ASC
	) AS row,
	*
	FROM platzi.alumnos
) AS duplicados
WHERE duplicados.row > 1;

--eliminar dilas con duplicados
DELETE FROM platzi.alumnos
WHERE id IN (
	SELECT id
	FROM (
		SELECT id,
		ROW_NUMBER() OVER(
			PARTITION BY
				nombre, apellido, email, colegiatura, fecha_incorporacion, carrera_id, tutor_id
			ORDER BY id ASC
		) AS row
		FROM platzi.alumnos
	) AS duplicados
	WHERE duplicados.row > 1
	);
